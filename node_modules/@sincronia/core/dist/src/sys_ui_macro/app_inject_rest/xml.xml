<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="jelly:core" xmlns:g2="glide">
	
	<g:evaluate jelly="true" object="true">
		var gr_sys_id = jelly.sys_id;
		var app_helper = new x_nuvo_mobile.NuvoloAppConfig(gr_sys_id);

		var can_access = app_helper.canAccess();
		var no_access_message = gs.getMessage("Security constraints prevent access to requested page");

		if (!can_access) {
			gs.addErrorMessage(no_access_message);
			gs.setRedirect("home.do");
		}

		var app_config = app_helper.getConfig();
		var translationConfig = app_config.translationConfig;
		var nuvoProperties = app_config.nuvoProperties;
		var scriptsArray = app_config.scripts;
		var scriptsIterator = 0;
	</g:evaluate>	
	<!-- TODO enhance app table with a related list of UI Scripts in order of loading preference -->
	<!-- TODO enhance app table with styling/theme information -->

	<script>
	(function(){
		 addDataset();
	
		function addDataset(){
			var id = "${jvar_id}";
			var el = document.getElementById(id);
			if(!el){ 
		         throw('Missing root element id. Did you forget to pass the "id" attribute to the macro?')
		    }
			el.style.overflow = 'hidden';
		}
	  })();
	</script>

	<script>
		(function(){
			window.g_ck = '$[gs.getSession().getSessionToken();]';
		})();
	</script>
	
	<j:choose>
		<j:when test="${can_access}">
			<j:while test="${scriptsIterator&lt;scriptsArray.length}">
				<script type="text/javascript" 
						src="${scriptsArray[scriptsIterator].src}?${scriptsArray[scriptsIterator].cache}" 
						params="${scriptsArray[scriptsIterator].cache}"/>
				<g:evaluate>scriptsIterator++</g:evaluate>
			</j:while>
		</j:when>
		<j:when test="${!can_access}">
			${no_access_message}
		</j:when>
	</j:choose>
</j:jelly>